# ZK Diseasechecker ZoKrates

Follow these steps in https://zokrates.github.io/gettingstarted.html

```
git clone https://github.com/ZoKrates/ZoKrates
cd ZoKrates
export ZOKRATES_STDLIB=$PWD/zokrates_stdlib/stdlib
cargo build -p zokrates_cli --release
cd target/release
```

To be able to run zokrates, I had to add the following paths into the startup script:

open file with `nano ~/.bashrc`

Then add 

```
export ZOKRATES_STDLIB=/mnt/c/Users/chine/EncodeBootcamp/ZKBootcamp/Zokrates/zokrates/zokrates_stdlib/stdlib
export PATH=$PATH:/mnt/c/Users/chine/EncodeBootcamp/ZKBootcamp/Zokrates/zokrates/target/release
```

then run 

`source ~/.bashrc`

Create the folder `Pharmacy`

Place `pharmacy.zok` inside with the following code:

```
def main(private field[5] arr, field target)  {
    bool mut found = false;
    for u32 i in 0..5 {
        found = if (arr[i] == target) {true} else {found};
    }
    assert(found);
}

```

code checks if `target` (number representing some medical condition) is contained in an array. The array is the whole medical record.

For example `1234` can represent "Asthma" and `5678` can represent "Diabetic"

run these steps:

```
# compile
zokrates compile -i pharmacy.zok
# perform the setup phase
zokrates setup
# execute the program
zokrates compute-witness -a 22 2312 1234 4444 3333 1234
# generate a proof of computation
zokrates generate-proof
# export a solidity verifier
zokrates export-verifier
```

In this case, the secret is `22 2312 1234 4444 3333` (representing the whole medical record of medical conditions), the last number `1234` is the input we want to check in the array (i.e. we want to check if Asthma is contained in the medical record), a verifier contract `verifier.sol` is generated.

If we run

`zokrates compute-witness -a 22 2312 1234 4444 3333 5678`, i.e. we check if "Diabetic" is in the medical record, this would fail.

The proof generated by

```
zokrates compute-witness -a 22 2312 1234 4444 3333 1234
zokrates generate-proof
```

is renamed from `proof.json` to `proof_1234.json`. This proof shows that "Asthma" is contained in the medical record.

```
zokrates compute-witness -a 22 2312 5678 4444 3333 5678
zokrates generate-proof
```

is renamed from `proof.json` to `proof_5678.json`. This proof shows that "Diabetic" is contained in the medical record.

The `verifier.sol` contract is deployed here: 

https://sepolia.etherscan.io/address/0x5bd187e20b0cd8a22c88764d7b0a1320565abaf1

We can verify the proof (see `proof_1234.json`) on Remix:

For example, insert

```

[[0x174364240ef0c0b8748c004957784a939bd4de5e7f8b4ca23960245eb9ba0449, 0x0d27949b6263088385fbc5a61ce071dce09bd9a06ac4c48ab7a901fa477d0fc0],             [[0x2f938b41f1fab6f0ad96b177701776553e98c2a2e03dd3c69163620b38ad470e, 0x0f99ee0f21c917a8654f3870783ee6b89cd2ce5d77feb633fad70eb46f162b76],
[0x2545411f630d14d957b7dd4860ef7ae1f911118bef843e3d0c446a70f2553eef, 0x0338db46527ad73f3fd9af8c3e7d20a2464d5c4def70095baab52944cd420954]],
[0x155649b61be11175cf8e5b0d2b0fc43fcc1cf08f6efc4113ae24ce1e9053e51c, 0x302836e50ee46f218969bd92a9b6a6d24e2edffac316884c7b612b949cd6c82a]],
[1234]
```

into `verifyTx`. [1234] (or `0x4d2` in hex) is the public input, the array

```
[[0x174364240ef0c0b8748c004957784a939bd4de5e7f8b4ca23960245eb9ba0449, 0x0d27949b6263088385fbc5a61ce071dce09bd9a06ac4c48ab7a901fa477d0fc0],             [[0x2f938b41f1fab6f0ad96b177701776553e98c2a2e03dd3c69163620b38ad470e, 0x0f99ee0f21c917a8654f3870783ee6b89cd2ce5d77feb633fad70eb46f162b76],
[0x2545411f630d14d957b7dd4860ef7ae1f911118bef843e3d0c446a70f2553eef, 0x0338db46527ad73f3fd9af8c3e7d20a2464d5c4def70095baab52944cd420954]],
[0x155649b61be11175cf8e5b0d2b0fc43fcc1cf08f6efc4113ae24ce1e9053e51c, 0x302836e50ee46f218969bd92a9b6a6d24e2edffac316884c7b612b949cd6c82a]]
```

is the proof that `1234` is contained in the medical record. The verifier contracgt can verify "Asthma".

The same works for `5678` (Diabetic) with a different proof (see `proof_5678.json`)

```
[[0x063d8a3a71f42e634eaa58eac8f260293d508ec932593363b63b5427f8f198ce, 0x0236cb02e5befc8807e85f7ee13140e611b078e31736bd1393dbccaffb791009],             [[0x0f191ca3c2840449a6c9cc51379e9c7cd5eff3ca775e391517f10d9f558c6a94, 0x2798a93744b34d1dbea99ba25af055f327178a599583e15ea17a3fc49536b16a],
[0x2aad9070b63071f9494759773f37b0cac6af0f47226dac44726c5e63deb22bdb, 0x0cd1e99bcc15eff705dd36aa460f19e0bec44a08d99dd4a3f5a54f0a1485a608]],
[0x01a7ad8d0d016f18de5cbb7f54f0bab9b67c5d285a6fe53beb011c41cb31be92, 0x1dbc5a192bffba31a16c5a95e14b7897133baef7dda88166c4d5c022699966a3]],
[5678]
```

`5678` is `0x162e` in hex.

![image](https://github.com/BigBangInfinity/Encode_ZKBootcamp_Homework/assets/37957341/e0e96051-e7d7-4b37-90b0-7eddadf4b408)
